var notError=function(t){"use strict";class e extends Error{constructor(t,e={},r=null){return super(t),this.options=e,this.adopt(r),this.fill(),this.getTime(),this}adopt(t){return t instanceof Error&&(this.parent=t),this}getStack(){return this.parent?this.parent.stack:this.stack}getDetails(){let t=this;return this.parent&&(t=this.parent),{columnNumber:t.columnNumber,fileName:t.fileName,lineNumber:t.lineNumber,name:t.name,message:t.message,stack:t.stack}}getTime(){let t=new Date;return this.env.date={timestamp:t.getTime(),offset:t.getTimezoneOffset()},this.env.date}fill(){return this.env={browser:!0,node:!1,document:{title:document.title},location:{hash:window.location.hash,port:window.location.port,protocol:window.location.protocol,search:window.location.search,host:window.location.host,url:window.location.url,href:window.location.href,hostname:window.location.hostname,pathname:window.location.pathname},navigator:{appName:navigator.appName,appCodeName:navigator.appCodeName,appVersion:navigator.appVersion,userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,product:navigator.product,onLine:navigator.onLine,cookieEnabled:navigator.cookieEnabled},window:{height:window.innerHeight,width:window.innerWidth}},this}}class r extends e{constructor(t,e={},r=null,i={}){return super(t,{fields:e,params:i},r),this}setFieldsErrors(t){this.options.fields=t}getFieldsErrors(){return this.options.fields}}class i extends e{constructor(t,{code:e,errors:r,redirect:i,params:n}={code:500,errors:{},redirect:!1,params:{}},o=null){return super(t,{code:e,errors:r,redirect:i,params:n},o),this}setRedirect(t){this.options.redirect=t}getRedirect(){return this.options.redirect}setCode(t){this.options.code=t}getCode(){return this.options.code}setErrors(t){this.options.errors=t}getErrors(){return this.options.errors}getResult(){return{message:this.message,code:this.getCode(),errors:this.getErrors(),redirect:this.getRedirect()}}}const n=["report@","notError@"],o=["file","path","type","line","column","function"],s=[{test:t=>{let e=[...t.matchAll(/(.*)@(.+):(\d+):(\d+)/gi)];if(e.length){let t=e[0];if(t&&t.length>2)return t}return!1},parse:t=>{if(t){let e=t[1].split("."),r=t[2].split("/"),i=r[r.length-1];r.pop();let n,o=r.join("/"),s=parseInt(t[3]),a=parseInt(t[4]),l=e[e.length-1];return l.replaceAll&&(l=l.replaceAll("/","").replaceAll("\\","").replaceAll(">","").replaceAll("<","")),r&&r.length&&(n=r.pop()),{file:i,path:o,line:s,column:a,function:l,type:n}}return!1}},{test:t=>{let e=[...t.matchAll(/\sat\s(.+)\s\((.+)\)/gi)];if(e.length){let t=e[0];if(t&&t.length>2)return t}return!1},parse:t=>{if(t){let e=t[1].split("."),r=t[2].split(":"),i=r[0].split("/"),n=i[i.length-1];i.pop();let o,s=i.join("/"),a=parseInt(r[1]),l=parseInt(r[2]),h=e[e.length-1];return h.replaceAll&&(h=h.replaceAll("/","").replaceAll("\\","").replaceAll(">","").replaceAll("<","")),i&&i.length&&(o=i.pop()),{file:n,path:s,line:a,column:l,function:h,type:o}}return!1}}],a=window.console,l="https://appmon.ru/api/key/collect",h={envFirst:!1,origin:{},url:void 0,key:void 0,registerAll:!0};const c="https://appmon.ru/api/key/collect";class p extends Error{constructor(t,e={}){return super(t),this.options=e,this.fill(),this.getTime(),this}adopt(t){return this.parent=t,this}getTime(){let t=new Date;return this.env.date={timestamp:t.getTime(),offset:t.getTimezoneOffset()},this.env.date}report(){let t=this.packError();return this._report(t,this.getReportURL())}packError(){let t={};return this.parent&&(t.parent={columnNumber:this.parent.columnNumber,fileName:this.parent.fileName,lineNumber:this.parent.lineNumber,message:this.parent.message,name:this.parent.name,stack:this.parent.stack}),t.details={columnNumber:this.columnNumber,fileName:this.fileName,lineNumber:this.lineNumber,name:this.name,message:this.message,stack:this.stack},t.options=this.options,t.env=this.env,t}fill(){return this.env={browser:!0,node:!1,location:{hash:window.location.hash,port:window.location.port,protocol:window.location.protocol,search:window.location.search,host:window.location.host,url:window.location.url,href:window.location.href,hostname:window.location.hostname,pathname:window.location.pathname}},this}getReportURL(){return window.NOT_NODE_ERROR_URL_BROWSER&&window.NOT_NODE_ERROR_URL_BROWSER.length>0?window.NOT_NODE_ERROR_URL_BROWSER:c.length>0?c:"https://appmon.ru/api/key/collect"}getReportKey(){return window.NOT_NODE_ERROR_KEY&&window.NOT_NODE_ERROR_KEY.length>0?window.NOT_NODE_ERROR_KEY:""}_report(t,e){let r={key:this.getReportKey(),report:t,type:"error"};return fetch(e,{method:"PUT",cache:"no-cache",headers:{"Content-Type":"application/json; charset=utf-8"},redirect:"follow",referrer:"no-referrer",body:JSON.stringify(r)})}}const u=new p;return t.notError=e,t.notErrorStandalone=u,t.notReporter=class{static notError=e;static notValidationError=r;static notRequestError=i;constructor(t=h){let{envFirst:e,origin:r,url:i,key:n,registerAll:o}=t;return this.envFirst=e,this.processWatching=!1,this.setOrigin(r),this.setKey(n),this.setURL(i),this.setRegisterAll(o),window.addEventListener("error",this.registerError.bind(this)),this}setOrigin(t){return this.origin=t,this}setKey(t){return this.key=t,this}setURL(t){return this.url=t,this}setRegisterAll(t=!0){return this.registerAll=t,this}errorIsReportable(t){return t instanceof e}async report(t,r){let i=!1;this.errorIsReportable(t)||(t=new e(t.message,{},t),i=!0);let n=await this.packError(t,i);return await this._report(n,this.getReportURL(),r,"error")}reportError(t,r={},i=null,n){return this.report(new e(t,r,i),n)}isLineParasite(t){return n.some((e=>t.includes(e)))}trunkStack(t){let e=t.split("\n");for(;e.length&&this.isLineParasite(e[0]);)e.shift();return e}__stackFirstLineParser(t){let e,r=s.find((r=>e=r.test(t)));return!!r&&r.parse(e)}__stackFirstLineSearcher(t){for(let e=0;t.length>e;e++){let r=t[e];if(!r)continue;let i=this.__stackFirstLineParser(r);if(i)return i}return!1}parseStack(t){try{let e=this.trunkStack(t);if(!this.__stackFirstLineSearcher(e))return{stack:e};let r=this.__stackFirstLineSearcher(e);return r?{stack:e,...r}:{stack:e}}catch(t){return a.error(t),!1}}extractDataFromError(t,e){let r=t.getDetails();if(r.stack){let t=this.parseStack(r.stack);t&&t.stack&&(e?(r.stack=t.stack.join("\n"),o.forEach((e=>{t[e]&&(r[e]=t[e])}))):o.forEach((e=>{r[e]||(r[e]=t[e])})))}return r}async packError(t,e=!1){let r={};return r.details=this.extractDataFromError(t,e),await this.tryToGetSourceBlock(r),r.options=t.options,r.env=t.env,r.origin=this.origin?this.origin:{},r}async tryToGetSourceBlock(t){if(t.details.fileName&&!isNaN(t.details.lineNumber))try{let e=await this.loadSources(t.details.fileName);if(e){let r=this.extractLinesFromFile(e,parseInt(t.details.lineNumber));t.lines=r}}catch(t){return!1}}extractLinesFromFile(t,e){let r=t.split("\n"),i=(e=parseInt(e)-1)-6,n=e+6;i<0&&(i=0),n>r.length-1&&(n=r.length-1);let o=[];for(let t=i;t<n;t++)o.push({l:t+1,txt:r[t],color:{danger:e===t}});return o}getReportURL(){return void 0!==this.url?this.url:window.NOT_NODE_ERROR_URL_BROWSER&&window.NOT_NODE_ERROR_URL_BROWSER.length>0?window.NOT_NODE_ERROR_URL_BROWSER:l.length>0?l:"/api/error"}getReportKey(){return void 0!==this.key?this.key:window.NOT_NODE_ERROR_KEY&&window.NOT_NODE_ERROR_KEY.length>0?window.NOT_NODE_ERROR_KEY:""}_report(t,e){let r={report:t,type:"error",key:this.getReportKey()};return fetch(e,{method:"PUT",cache:"no-cache",headers:{"Content-Type":"application/json; charset=utf-8"},redirect:"follow",referrer:"no-referrer",body:JSON.stringify(r)})}async loadSources(t){let e=await fetch(t);return 200===parseInt(e.status)&&await e.text()}registerError(t){this.registerAll&&this.report(t.error)}},t.notRequestError=i,t.notValidationError=r,Object.defineProperty(t,"__esModule",{value:!0}),t}({});
