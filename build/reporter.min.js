var notErrorReporter=function(){"use strict";class t extends Error{constructor(t,e={},r=null){return super(t),this.options=e,this.adopt(r),this.fill(),this.getTime(),this}adopt(t){return t&&(this.parent=t),this}getStack(){return this.parent?this.parent.stack:this.stack}getDetails(){let t=this;return this.parent&&(t=this.parent),{columnNumber:t.columnNumber,fileName:t.fileName,lineNumber:t.lineNumber,name:t.name,message:t.message,stack:t.stack}}getTime(){let t=new Date;return this.env.date={timestamp:t.getTime(),offset:t.getTimezoneOffset()},this.env.date}fill(){return this.env={browser:!0,node:!1,document:{title:document.title},location:{hash:window.location.hash,port:window.location.port,protocol:window.location.protocol,search:window.location.search,host:window.location.host,url:window.location.url,href:window.location.href,hostname:window.location.hostname,pathname:window.location.pathname},navigator:{appName:navigator.appName,appCodeName:navigator.appCodeName,appVersion:navigator.appVersion,userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,product:navigator.product,onLine:navigator.onLine,cookieEnabled:navigator.cookieEnabled},window:{height:window.innerHeight,width:window.innerWidth}},this}}const e=["report@","notError@"],r=["fileName","filePath","lineNumber","columnNumber","functionName","type"],i=window.console,n="https://appmon.ru/api/key/collect";return class{constructor(t=!1){return this.url=void 0,this.key=void 0,this.envFirst=t,this.processWatching=!1,this.origin={},window.addEventListener("error",this.registerError.bind(this)),this}setOrigin(t){return this.origin=t,this}setKey(t){return this.key=t,this}setURL(t){return this.url=t,this}setRegisterAll(t=!0){return this.registerAll=t,this}async report(e,r){let i=!1;e instanceof t||(e=new t(e.message,{},e),i=!0);let n=await this.packError(e,i);return await this._report(n,this.getReportURL(),r,"error")}reportError(e,r={},i=null,n){return this.report(new t(e,r,i),n)}isLineParasite(t){return e.some((e=>t.includes(e)))}trunkStack(t){let e=t.split("\n");for(;e.length&&this.isLineParasite(e[0]);)e.shift();return e}parseStack(t){try{let e=this.trunkStack(t),r=e[0];if(!r)return{stack:e};let i=[...r.matchAll(/(.*)@(.+):(\d+):(\d+)/gi)][0];if(!i||i.length<2)return{stack:e};let n=i[1].replaceAll("/","").replaceAll("\\","").replaceAll(">","").replaceAll("<",""),o=i[2],a=o.split("/"),s=a.length?a[a.length-1]:"",l=a.length>1?a[a.length-2]:"",h=i[3];return{stack:e,functionName:n,type:l,fileName:s,filePath:o,lineNumber:parseInt(h)}}catch(t){return i.error(t),!1}}extractDataFromError(t,e){let i=t.getDetails();if(i.stack){let t=this.parseStack(i.stack);t&&t.stack&&(e?(i.stack=t.stack.join("\n"),r.forEach((e=>{t[e]&&(i[e]=t[e])}))):r.forEach((e=>{i[e]||(i[e]=t[e])})))}return i}async packError(t,e=!1){let r={};return r.details=this.extractDataFromError(t,e),await this.tryToGetSourceBlock(r),r.options=t.options,r.env=t.env,r.origin=this.origin?this.origin:{},r}async tryToGetSourceBlock(t){if(t.details.filePath&&!isNaN(t.details.lineNumber))try{let e=await this.loadSources(t.details.filePath);if(e){let r=this.extractLinesFromFile(e,parseInt(t.details.lineNumber));t.lines=r}}catch(t){return!1}}extractLinesFromFile(t,e){let r=t.split("\n"),i=(e=parseInt(e)-1)-6,n=e+6;i<0&&(i=0),n>r.length-1&&(n=r.length-1);let o=[];for(let t=i;t<n;t++)o.push({l:t+1,txt:r[t],color:{danger:e===t}});return o}getReportURL(){return void 0!==this.url?this.url:window.NOT_NODE_ERROR_URL_BROWSER&&window.NOT_NODE_ERROR_URL_BROWSER.length>0?window.NOT_NODE_ERROR_URL_BROWSER:n.length>0?n:"/api/error"}getReportKey(){return void 0!==this.key?this.key:window.NOT_NODE_ERROR_KEY&&window.NOT_NODE_ERROR_KEY.length>0?window.NOT_NODE_ERROR_KEY:""}_report(t,e){let r={report:t,type:"error",key:this.getReportKey()};return fetch(e,{method:"PUT",cache:"no-cache",headers:{"Content-Type":"application/json; charset=utf-8"},redirect:"follow",referrer:"no-referrer",body:JSON.stringify(r)})}async loadSources(t){let e=await fetch(t);return 200===parseInt(e.status)&&await e.text()}registerError(t){this.registerAll&&this.report(t.error)}}}();
