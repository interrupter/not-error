var notErrorReporter=function(){"use strict";function e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function t(e,t,r,n,i,o,a){try{var u=e[o](a),c=u.value}catch(e){return void r(e)}u.done?t(c):Promise.resolve(c).then(n,i)}function r(e){return function(){var r=this,n=arguments;return new Promise((function(i,o){var a=e.apply(r,n);function u(e){t(a,i,o,u,c,"next",e)}function c(e){t(a,i,o,u,c,"throw",e)}u(void 0)}))}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function l(e,t,r){return(l=s()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&c(i,r.prototype),i}).apply(null,arguments)}function f(e){var t="function"==typeof Map?new Map:void 0;return(f=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return l(e,arguments,u(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),c(n,e)})(e)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?p(e):t}function v(e){return function(e){if(Array.isArray(e))return y(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return y(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return y(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var g=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(a,e);var t,r,i=(t=a,r=s(),function(){var e,n=u(t);if(r){var i=u(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return h(this,e)});function a(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return n(this,a),(t=i.call(this,e)).options=r,t.adopt(o),t.fill(),t.getTime(),h(t,p(t))}return o(a,[{key:"adopt",value:function(e){return e&&(this.parent=e),this}},{key:"getStack",value:function(){return this.parent?this.parent.stack:this.stack}},{key:"getDetails",value:function(){var e=this;return this.parent&&(e=this.parent),{columnNumber:e.columnNumber,fileName:e.fileName,lineNumber:e.lineNumber,name:e.name,message:e.message,stack:e.stack}}},{key:"getTime",value:function(){var e=new Date;return this.env.date={timestamp:e.getTime(),offset:e.getTimezoneOffset()},this.env.date}},{key:"fill",value:function(){return this.env={browser:!0,node:!1,document:{title:document.title},location:{hash:window.location.hash,port:window.location.port,protocol:window.location.protocol,search:window.location.search,host:window.location.host,url:window.location.url,href:window.location.href,hostname:window.location.hostname,pathname:window.location.pathname},navigator:{appName:navigator.appName,appCodeName:navigator.appCodeName,appVersion:navigator.appVersion,userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,product:navigator.product,onLine:navigator.onLine,cookieEnabled:navigator.cookieEnabled},window:{height:window.innerHeight,width:window.innerWidth}},this}}]),a}(f(Error)),d=["report@","notError@"],m=["fileName","filePath","fileDir","lineNumber","columnNumber","functionName"],w=[{test:function(e){var t=v(e.matchAll(/(.*)@(.+):(\d+):(\d+)/gi));if(t.length){var r=t[0];if(r&&r.length>2)return r}return!1},parse:function(e){if(!e)return!1}},{test:function(e){var t=v(e.matchAll(/\sat\s(.+)\s\((.+)\)/gi));if(t.length){var r=t[0];if(r&&r.length>2)return r}return!1},parse:function(e){if(e){var t,r,n=e[1].split("."),i=e[2].split(":"),o=i[0],a=i[0],u=parseInt(i[1]),c=parseInt(i[2]),s=n[n.length-1];s.replaceAll&&(s=s.replaceAll("/","").replaceAll("\\","").replaceAll(">","").replaceAll("<",""));try{path&&(t=!!path&&path.parse(o))&&(r=t.dir.split("/").pop())}catch(e){}return{fileName:o,filePath:a,lineNumber:u,columnNumber:c,functionName:s,fileDir:r}}return!1}}],b=window.console,k="https://appmon.ru/api/key/collect",O={envFirst:!1,origin:{},url:void 0,key:void 0,registerAll:!0};return function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O;n(this,t);var r=e.envFirst,i=e.origin,o=e.url,a=e.key,u=e.registerAll;return this.envFirst=r,this.processWatching=!1,this.setOrigin(i),this.setKey(a),this.setURL(o),this.setRegisterAll(u),window.addEventListener("error",this.registerError.bind(this)),this}var i,u,c,s;return o(t,[{key:"setOrigin",value:function(e){return this.origin=e,this}},{key:"setKey",value:function(e){return this.key=e,this}},{key:"setURL",value:function(e){return this.url=e,this}},{key:"setRegisterAll",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.registerAll=e,this}},{key:"report",value:(s=r(regeneratorRuntime.mark((function e(t,r){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=!1,"notError"!==t.constructor.name&&(t=new g(t.message,{},t),n=!0),e.next=4,this.packError(t,n);case 4:return i=e.sent,e.next=7,this._report(i,this.getReportURL(),r,"error");case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"reportError",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3?arguments[3]:void 0;return this.report(new g(e,t,r),n)}},{key:"isLineParasite",value:function(e){return d.some((function(t){return e.includes(t)}))}},{key:"trunkStack",value:function(e){for(var t=e.split("\n");t.length&&this.isLineParasite(t[0]);)t.shift();return t}},{key:"__stackFirstLineParser",value:function(e){var t,r=w.find((function(r){return t=r.test(e)}));return!!r&&r.parse(t)}},{key:"__stackFirstLineSearcher",value:function(e){for(var t=0;e.length>t;t++){var r=e[t];if(r){var n=this.__stackFirstLineParser(r);if(n)return n}}return!1}},{key:"parseStack",value:function(t){try{var r=this.trunkStack(t);if(!this.__stackFirstLineSearcher(r))return{stack:r};var n=this.__stackFirstLineSearcher(r);return n?function(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?e(Object(n),!0).forEach((function(e){a(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({stack:r},n):{stack:r}}catch(e){return b.error(e),!1}}},{key:"extractDataFromError",value:function(e,t){var r=e.getDetails();if(r.stack){var n=this.parseStack(r.stack);n&&n.stack&&(t?(r.stack=n.stack.join("\n"),m.forEach((function(e){n[e]&&(r[e]=n[e])}))):m.forEach((function(e){r[e]||(r[e]=n[e])})))}return r}},{key:"packError",value:(c=r(regeneratorRuntime.mark((function e(t){var r,n,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>1&&void 0!==i[1]&&i[1],(n={}).details=this.extractDataFromError(t,r),e.next=5,this.tryToGetSourceBlock(n);case 5:return n.options=t.options,n.env=t.env,n.origin=this.origin?this.origin:{},e.abrupt("return",n);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"tryToGetSourceBlock",value:(u=r(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.details.filePath||isNaN(t.details.lineNumber)){e.next=11;break}return e.prev=1,e.next=4,this.loadSources(t.details.filePath);case 4:(r=e.sent)&&(n=this.extractLinesFromFile(r,parseInt(t.details.lineNumber)),t.lines=n),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",!1);case 11:case"end":return e.stop()}}),e,this,[[1,8]])}))),function(e){return u.apply(this,arguments)})},{key:"extractLinesFromFile",value:function(e,t){var r=e.split("\n"),n=(t=parseInt(t)-1)-6,i=t+6;n<0&&(n=0),i>r.length-1&&(i=r.length-1);for(var o=[],a=n;a<i;a++)o.push({l:a+1,txt:r[a],color:{danger:t===a}});return o}},{key:"getReportURL",value:function(){return void 0!==this.url?this.url:window.NOT_NODE_ERROR_URL_BROWSER&&window.NOT_NODE_ERROR_URL_BROWSER.length>0?window.NOT_NODE_ERROR_URL_BROWSER:k.length>0?k:"/api/error"}},{key:"getReportKey",value:function(){return void 0!==this.key?this.key:window.NOT_NODE_ERROR_KEY&&window.NOT_NODE_ERROR_KEY.length>0?window.NOT_NODE_ERROR_KEY:""}},{key:"_report",value:function(e,t){var r={report:e,type:"error",key:this.getReportKey()};return fetch(t,{method:"PUT",cache:"no-cache",headers:{"Content-Type":"application/json; charset=utf-8"},redirect:"follow",referrer:"no-referrer",body:JSON.stringify(r)})}},{key:"loadSources",value:(i=r(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:if(r=e.sent,200!==parseInt(r.status)){e.next=9;break}return e.next=6,r.text();case 6:return e.abrupt("return",e.sent);case 9:return e.abrupt("return",!1);case 10:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})},{key:"registerError",value:function(e){this.registerAll&&this.report(e.error)}}]),t}()}();
