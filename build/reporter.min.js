var notErrorReporter=function(){"use strict";class e extends Error{constructor(e,t={},r=null){return super(e),this.options=t,this.adopt(r),this.fill(),this.getTime(),this}adopt(e){return e&&(this.parent=e),this}getStack(){return this.parent?this.parent.stack:this.stack}getDetails(){let e=this;return this.parent&&(e=this.parent),{columnNumber:e.columnNumber,fileName:e.fileName,lineNumber:e.lineNumber,name:e.name,message:e.message,stack:e.stack}}getTime(){let e=new Date;return this.env.date={timestamp:e.getTime(),offset:e.getTimezoneOffset()},this.env.date}fill(){return this.env={browser:!0,node:!1,document:{title:document.title},location:{hash:window.location.hash,port:window.location.port,protocol:window.location.protocol,search:window.location.search,host:window.location.host,url:window.location.url,href:window.location.href,hostname:window.location.hostname,pathname:window.location.pathname},navigator:{appName:navigator.appName,appCodeName:navigator.appCodeName,appVersion:navigator.appVersion,userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,product:navigator.product,onLine:navigator.onLine,cookieEnabled:navigator.cookieEnabled},window:{height:window.innerHeight,width:window.innerWidth}},this}}const t=["report@","notError@"],r=window.console,i="https://appmon.ru/api/key/collect";return class{constructor(e=!1){return this.envFirst=e,this.processWatching=!1,this.origin={},window.addEventListener("error",this.registerError.bind(this)),this}setOrigin(e){this.origin=e}setRegisterAll(e=!0){this.registerAll=e}async report(t,r){let i=!1;t instanceof e||(t=new e(t.message,{},t),i=!0);let n=await this.packError(t,i);return await this._report(n,this.getReportURL(),r,"error")}reportError(t,r={},i=null,n){return this.report(new e(t,r,i),n)}isLineParasite(e){return t.some((t=>e.includes(t)))}trunkStack(e){let t=e.split("\n");for(;t.length&&this.isLineParasite(t[0]);)t.shift();return t}parseStack(e){try{let t=this.trunkStack(e),r=[...t[0].matchAll(/(.*)@(.+):(\d+):(\d+)/gi)][0];if(!r)return{};let i=r[1].replace("/","").replace("\\","").replace(">","").replace("<",""),n=r[2],o=n.split("/"),a=o.length?o[o.length-1]:"",s=o.length>1?o[o.length-2]:"",l=r[3];return{stack:t,functionName:i,type:s,fileName:a,filePath:n,lineNumber:parseInt(l)}}catch(e){return r.error(e),!1}}extractDataFromError(e,t){let r=e.getDetails();if(r.stack){let e=this.parseStack(r.stack);e&&e.stack&&(t?(r.stack=e.stack.join("\n"),e.fileName&&(r.fileName=e.fileName),e.columnNumber&&(r.columnNumber=e.columnNumber),e.lineNumber&&(r.lineNumber=e.lineNumber),e.functionName&&(r.functionName=e.functionName),e.type&&(r.type=e.type),e.filePath&&(r.filePath=e.filePath)):(r.fileName||(r.fileName=e.fileName),r.lineNumber||(r.lineNumber=e.lineNumber),r.columnNumber||(r.columnNumber=e.columnNumber),r.functionName||(r.functionName=e.functionName),r.type||(r.type=e.type)))}return r}async packError(e,t=!1){let r={};return r.details=this.extractDataFromError(e,t),await this.tryToGetSourceBlock(r),r.options=e.options,r.env=e.env,r.origin=this.origin?this.origin:{},r}async tryToGetSourceBlock(e){if(e.details.filePath&&!isNaN(e.details.lineNumber))try{let t=await this.loadSources(e.details.filePath);if(t){let r=this.extractLinesFromFile(t,parseInt(e.details.lineNumber));e.lines=r}}catch(e){return!1}}extractLinesFromFile(e,t){let r=e.split("\n"),i=(t=parseInt(t)-1)-6,n=t+6;i<0&&(i=0),n>r.length-1&&(n=r.length-1);let o=[];for(let e=i;e<n;e++)o.push({l:e+1,txt:r[e],color:{danger:t===e}});return o}getReportURL(){return window.NOT_NODE_ERROR_URL_BROWSER&&window.NOT_NODE_ERROR_URL_BROWSER.length>0?window.NOT_NODE_ERROR_URL_BROWSER:i.length>0?i:"/api/error"}getReportKey(){return window.NOT_NODE_ERROR_KEY&&window.NOT_NODE_ERROR_KEY.length>0?window.NOT_NODE_ERROR_KEY:""}_report(e,t){let r={report:e,type:"error",key:this.getReportKey()};return fetch(t,{method:"PUT",cache:"no-cache",headers:{"Content-Type":"application/json; charset=utf-8"},redirect:"follow",referrer:"no-referrer",body:JSON.stringify(r)})}async loadSources(e){let t=await fetch(e);return 200===parseInt(t.status)&&await t.text()}registerError(e){this.registerAll&&this.report(e.error)}}}();
